@model IEnumerable<SistemaGestionJudicial.Models.PartePolicial>

@{
    ViewData["Title"] = "Policial";
}

@section Styles {
    <link rel="stylesheet" href="~/css/partespoliciales.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
}

<div class="flex h-screen overflow-hidden">
    <div class="flex-1 overflow-auto">
        <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center no-print">
            <h2 class="text-xl font-semibold text-gray-800" id="view-title">Gestión de Partes Policiales</h2>
        </header>

        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Partes Policiales</h2>
                <a asp-controller="Police" asp-action="Create"
                   class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> Agregar Parte
                </a>
            </div>

            <div class="card bg-white rounded-lg p-6">
                <div class="overflow-x-auto">
                    <table class="data-table w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">ID</th>
                                <th class="border border-gray-300 px-4 py-2">Fecha</th>
                                <th class="border border-gray-300 px-4 py-2">Policía</th>
                                <th class="border border-gray-300 px-4 py-2">Descripción</th>
                                <th class="border border-gray-300 px-4 py-2">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var parte in Model)
                            {
                                <tr>
                                    <td class="border border-gray-300 px-4 py-2">@parte.Id_Parte</td>
                                    <td class="border border-gray-300 px-4 py-2">@parte.Fecha_Parte.ToShortDateString()</td>
                                    <td class="border border-gray-300 px-4 py-2">
                                        @(parte.PersonaPolicia != null ? $"{parte.PersonaPolicia.Nombres} {parte.PersonaPolicia.Apellidos}" : "Desconocido")
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2">@parte.Descripcion</td>
                                    <td class="border border-gray-300 px-4 py-2">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2 btn-show-detail"
                                                data-id="@parte.Id_Parte"
                                                data-fecha="@parte.Fecha_Parte.ToShortDateString()"
                                                data-policia="@(parte.PersonaPolicia != null ? parte.PersonaPolicia.Nombres + " " + parte.PersonaPolicia.Apellidos : "Desconocido")"
                                                data-descripcion="@parte.Descripcion"
                                                data-denuncia="@(parte.Denuncia != null ? parte.Denuncia.Descripcion : "")">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <a asp-controller="Police" asp-action="Edit" asp-route-id="@parte.Id_Parte"
                                           class="text-green-600 hover:text-green-800 mr-2">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form asp-controller="Police" asp-action="Delete" method="post" style="display:inline" onsubmit="return confirm('¿Seguro que quieres eliminar este parte?');">
                                            <input type="hidden" name="id" value="@parte.Id_Parte" />
                                            <button type="submit" class="text-red-600 hover:text-red-800 border-none bg-transparent p-0">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
        <h3 class="text-xl font-bold mb-4">Detalle del Parte Policial</h3>
        <p><strong>ID:</strong> <span id="modalId"></span></p>
        <p><strong>Fecha:</strong> <span id="modalFecha"></span></p>
        <p><strong>Policía:</strong> <span id="modalPolicia"></span></p>
        <p><strong>Descripción:</strong> <span id="modalDescripcion"></span></p>
        <p><strong>Denuncia:</strong> <span id="modalDenuncia"></span></p>
        <div class="mt-6 text-right">
            <button id="closeModalBtn" class="bg-gray-500 text-white px-4 py-2 rounded">Cerrar</button>
        </div>
    </div>
</div>

<!-- Script para abrir y cerrar modal -->
<script>
    document.querySelectorAll('.btn-show-detail').forEach(btn => {
        btn.addEventListener('click', function () {
            document.getElementById('modalId').textContent = this.dataset.id;
            document.getElementById('modalFecha').textContent = this.dataset.fecha;
            document.getElementById('modalPolicia').textContent = this.dataset.policia;
            document.getElementById('modalDescripcion').textContent = this.dataset.descripcion;
            document.getElementById('modalDenuncia').textContent = this.dataset.denuncia;

            document.getElementById('detailModal').classList.remove('hidden');
        });
    });

    document.getElementById('closeModalBtn').addEventListener('click', () => {
        document.getElementById('detailModal').classList.add('hidden');
    });
</script>